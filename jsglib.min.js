let dispatchEvent=(c,d,a={})=>{let b=new CustomEvent(d,{detail:a.detail||{},bubbles:!!a.bubbles,cancelable:!!a.cancelable,composed:void 0===a.composed?!!a.bubbles:!!a.composed});return c.dispatchEvent(b),b},random=(a,b)=>Math.floor(Math.random()*(b-a+1))+a,cleanDuration=a=>("number"==typeof a&&(a+="s"),a),getDurationUnit=a=>{if("number"==typeof a)return"s";if("string"==typeof a){let b=a.length;if(!b)return"s";let c=b;for(;c--;)if(/\d/.test(a[c]))return a.slice(c+1,b)||"s"}return"s"},getFromAttribute=(a,b,c)=>a.hasAttribute(b)?a.getAttribute(b):c,getFromAttributeAsInt=(b,c,d)=>{let a=getFromAttribute(b,c,null);return null===a?d:parseInt(a,10)},applyIsAttribute=a=>{if(!a.hasAttribute("is"))return;let b=a.getAttribute("is"),c=window._jsglibCustomClasses[b];if(!c)throw new Error(`[JSGLib] "is" attribute "${b}" of <${a.tagName.toLowerCase()}> has not been registered via JSGLib.define`);let d=c(a);if(!d)return;let e=document.createElement("template");e.innerHTML=d,a.shadowRoot.querySelector("slot").parentNode.appendChild(e.content.cloneNode(!0))};function getClosestGameFromNode(b){let c=b.closest("[data-jsglib-game]");if(c)return c;let a=b.parentNode;do{if(a._jsglibGame)return a._jsglibGame;a=a.parentNode}while(a)return null}let utils={dispatchEvent,random,cleanDuration,getDurationUnit,getFromAttribute,getFromAttributeAsInt,applyIsAttribute,getClosestGameFromNode},gameTemplate=document.createElement("template");gameTemplate.innerHTML=`<style>:host{display: block;position: relative;margin: auto;background-color: #000;overflow: hidden;box-sizing: border-box;transform-origin: top left;touch-action: manipulation;image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -o-crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: pixelated;image-rendering: optimize-contrast;-ms-interpolation-mode: nearest-neighbor;}</style><slot></slot>`;class JSGLibGame extends HTMLElement{constructor(){super();let a=this.attachShadow({mode:"open"});a.appendChild(gameTemplate.content.cloneNode(!0)),this.frameIndex=0,this.fps=0,this.mouse={x:0,y:0},this.cachedBoundingClientRect=null}connectedCallback(){this.setAttribute("data-jsglib-game",1),this.fps=getFromAttributeAsInt(this,"fps",60),this.width=getFromAttributeAsInt(this,"width","auto"),this.height=getFromAttributeAsInt(this,"height","auto"),this.zoom=getFromAttributeAsInt(this,"zoom",1),this.addEventListener("mousemove",a=>{this.mouse.x=a.clientX-this.x,this.mouse.y=a.clientY-this.y}),this.__resetCachedBoundingClientRect=()=>this.cachedBoundingClientRect=null,window.addEventListener("resize",this.__resetCachedBoundingClientRect),window.addEventListener("scroll",this.__resetCachedBoundingClientRect),applyIsAttribute(this)}disconnectedCallback(){window.removeEventListener("resize",this.__resetCachedBoundingClientRect),window.removeEventListener("scroll",this.__resetCachedBoundingClientRect)}getBoundingClientRect(){if(!this.cachedBoundingClientRect){let a=super.getBoundingClientRect(),c=window.getComputedStyle(this);if(0===this._zoom)this.cachedBoundingClientRect={width:0,height:0,left:Math.floor(a.left),top:Math.floor(a.top)};else{let b=Math.abs(this._zoom);this.cachedBoundingClientRect={width:a.width/b,height:a.height/b,left:Math.floor(a.left/b)+parseInt(c.borderLeftWidth,10),top:Math.floor(a.top/b)+parseInt(c.borderTopWidth,10)}}}return this.cachedBoundingClientRect}createElement({name:b,attributes:d,disableAppend:f,nextTo:c}={}){let e=!!customElements.get(b),a=document.createElement(e?b:"jsglib-element");if(a.game=this,d)for(let[g,h]of Object.entries(d))a.setAttribute(g,h);return!e&&Boolean(b)&&a.setAttribute("is",b),f||(c?c.parentNode.insertBefore(a,c):this.appendChild(a)),a}get x(){return this.getBoundingClientRect().left}get y(){return this.getBoundingClientRect().top}get width(){return this.getBoundingClientRect().width}set width(a){this.cachedBoundingClientRect=null,this.style.width=`${a}px`}get height(){return this.getBoundingClientRect().height}set height(a){this.cachedBoundingClientRect=null,this.style.height=`${a}px`}get zoom(){return this._zoom}set zoom(a){this._zoom!==a&&(this._zoom=a,this.style.transform=`scale(${a})`)}}let transformTemplate=document.createElement("template");function get(a,b,c){return a[b][c]}function set(a,b,c,d){a[b][c]=d}transformTemplate.innerHTML=`<style>:host{display: block;position: absolute;inset: 0;transform-origin: center;}</style><slot></slot>`;class JSGLibTransform extends HTMLElement{constructor(){super();let a=this.attachShadow({mode:"open"});a.appendChild(transformTemplate.content.cloneNode(!0)),this._transition={},this._transform={}}connectedCallback(){this.property=this.hasAttribute("property")?this.getAttribute("property"):"translateX",this.value=this.hasAttribute("value")?this.getAttribute("value"):0,this.prevValue=this.value,this.duration=this.hasAttribute("duration")?this.getAttribute("duration"):0,this.timingFunction=this.hasAttribute("timing-function")?this.getAttribute("timing-function"):"linear",this.applyTransform(),this.addEventListener("transitionend",a=>{a.target===this&&dispatchEvent(a.target,"jsglib:transformationEnd",{detail:{prevValue:parseInt(this.prevValue,10),nextValue:parseInt(this.value,10),fullPrevValue:this.prevValue,fullNextValue:this.value},bubbles:!1})})}get value(){return get(this,"_transform","value")}set value(a){this.prevValue=this.value,set(this,"_transform","value",a)}get property(){return get(this,"_transform","property")}set property(a){set(this,"_transform","property",a)}get duration(){return get(this,"_transition","duration")}set duration(a){set(this,"_transition","duration",cleanDuration(a))}get timingFunction(){return get(this,"_transition","timingFunction")}set timingFunction(a){set(this,"_transition","timingFunction",a)}get speed(){let{prevValue:c,value:d,duration:b}=this,a=parseInt(b,10);if(!a)return 0;let e=parseInt(d,10)-parseInt(c,10),f=getDurationUnit(b);return"s"!==f&&(a/=1e3),e/a}applyTransform(){this.style.transition=`transform ${this.duration} ${this.timingFunction}`,this.style.transform=`${this.property}(${this.value})`}}let elemTemplate=document.createElement("template"),getBaseTemplate=a=>`<style>:host{display: block;position: absolute;padding: 0;left: 0;top: 0;z-index: 0;}slot, ::slotted(*){display: block;position: absolute;inset: 0;transform-origin: center;}</style><jsglib-transform property="translateY"><jsglib-transform property="translateX">${a}</jsglib-transform></jsglib-transform>`;function getBoundedX(a,b){return Math.floor(Math.max(a.xmin,Math.min(a.xmax,b)))}function getBoundedY(a,b){return Math.floor(Math.max(a.ymin,Math.min(a.ymax,b)))}class JSGLibElement extends HTMLElement{constructor(){super();let a=this.attachShadow({mode:"open"});elemTemplate.innerHTML=getBaseTemplate(this.getInitialTemplate()),a.appendChild(elemTemplate.content.cloneNode(!0)),this.game=null,this._transformContainers={},this._content=null,this._cachedBoundingClientRect=null,this.clearCachedBoundingClientRectClock=null,this._onEndX=null,this._onEndY=null}getInitialTemplate(){return"<slot></slot>"}connectedCallback(){if(this.game=getClosestGameFromNode(this),!this.game)throw new Error(`[JSGLib] Element <${this.tagName.toLowerCase()}> is not wrapped into a <jsglib-game> element.`);this.shadowRoot._game=this.game,this.stickyContainer=this.closest("[data-jsglib-sticky-container]"),this.setAttribute("data-jsglib-element",1),this._transformContainers={translateX:this.shadowRoot.querySelector('jsglib-transform[property="translateX"]'),translateY:this.shadowRoot.querySelector('jsglib-transform[property="translateY"]')},this._content=this.shadowRoot.querySelector("slot"),this._content._jsglibElement=this,this.xmin=getFromAttributeAsInt(this,"xmin",-1/0),this.ymin=getFromAttributeAsInt(this,"ymin",-1/0),this.xmax=getFromAttributeAsInt(this,"xmax",1/0),this.ymax=getFromAttributeAsInt(this,"ymax",1/0),this.width=getFromAttributeAsInt(this,"width",16),this.height=getFromAttributeAsInt(this,"height",16),window.requestAnimationFrame(()=>{this.x=getFromAttributeAsInt(this,"x",0),this.y=getFromAttributeAsInt(this,"y",0),this.hspeed=getFromAttributeAsInt(this,"hspeed",0),this.vspeed=getFromAttributeAsInt(this,"vspeed",0),applyIsAttribute(this),dispatchEvent(this,"jsglib:ready",{bubbles:!0})})}disconnectedCallback(){this.clearCachedBoundingClientRectClock&&window.clearTimeout(this.clearCachedBoundingClientRectClock),dispatchEvent(this,"jsglib:destroy")}getBoundingClientRect(){if(!this._cachedBoundingClientRect){let a=this._content.getBoundingClientRect(),b=Math.abs(this.game._zoom),d=Boolean(this.stickyContainer),c=d?{x:0,y:0}:{x:this.game.scrollLeft,y:this.game.scrollTop};0===b?this._cachedBoundingClientRect={width:0,height:0,left:Math.floor(a.left)+c.x,top:Math.floor(a.top)+c.y}:this._cachedBoundingClientRect={width:a.width/b,height:a.height/b,left:Math.floor(a.left/b)+c.x,top:Math.floor(a.top/b)+c.y},this.clearCachedBoundingClientRectClock=window.setTimeout(()=>{this._cachedBoundingClientRect=null},1e3/this.game.fps)}return this._cachedBoundingClientRect}_clearOnEndX(){this._onEndX&&(this._transformContainers.translateX.removeEventListener("jsglib:transformationEnd",this._onEndX),this._onEndX=null)}_clearOnEndY(){this._onEndY&&(this._transformContainers.translateY.removeEventListener("jsglib:transformationEnd",this._onEndY),this._onEndY=null)}get x(){return this.getBoundingClientRect().left-this.game.x}set x(a){this._transformContainers.translateX.value=`${getBoundedX(this,a)}px`,this._transformContainers.translateX.applyTransform()}get y(){return this.getBoundingClientRect().top-this.game.y}set y(a){this._transformContainers.translateY.value=`${getBoundedY(this,a)}px`,this._transformContainers.translateY.applyTransform()}get width(){return this.getBoundingClientRect().width}set width(a){this.style.width=`${a}px`}get height(){return this.getBoundingClientRect().height}set height(a){this.style.height=`${a}px`}get hspeed(){return this._transformContainers.translateX.speed}set hspeed(a){if(this.hspeed!==a||0!==parseFloat(this._transformContainers.translateX.duration)){if(0===a)this._clearOnEndX(),this._transformContainers.translateX.duration=0,this.x=this.x;else{let b=Math.sign(a);this.moveX(this.x+9999*b,{speed:Math.abs(a),timingFunction:"linear",behavior:"repeat"})}}}get vspeed(){return this._transformContainers.translateY.speed}set vspeed(a){if(this.vspeed!==a||0!==parseFloat(this._transformContainers.translateY.duration)){if(0===a)this._clearOnEndY(),this._transformContainers.translateY.duration=0,this.y=this.y;else{let b=Math.sign(a);this.moveY(this.y+9999*b,{speed:Math.abs(a),timingFunction:"linear",behavior:"repeat"})}}}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}moveX(d,a={}){let e=this.x,b=getBoundedX(this,d),g=b-e,f=a.timingFunction||"linear",h=a.behavior||null,c=0;if(a.duration||a.speed){if(a.duration&&a.speed)throw new Error(`[JSGLib] Trying to call <${this.tagName.toLowerCase()}>.moveX(${d}) with duration ${a.duration} AND speed ${a.speed}: "duration" and "speed" options cannot be both set in the same call.`);c=a.duration?cleanDuration(a.duration):cleanDuration(Math.abs(g)/a.speed)}let i={prevX:e,nextX:b,duration:c,timingFunction:f,behavior:h},j=dispatchEvent(this,"jsglib:beforeMoveX",{detail:i,cancelable:!0,bubbles:!0});if(j.defaultPrevented)return!1;this._clearOnEndX(),this._onEndX=()=>{let b=dispatchEvent(this,"jsglib:afterMoveX",{detail:i,cancelable:!0,bubbles:!0});if(b.defaultPrevented)return!1;"reverse"===h?this.moveX(e,a):"repeat"===h&&this.moveX(this.x+g,a)},this._transformContainers.translateX.addEventListener("jsglib:transformationEnd",this._onEndX,{once:!0}),this._transformContainers.translateX.duration=c,this._transformContainers.translateX.timingFunction=f,this.x=b}moveY(d,a={}){let e=this.y,b=getBoundedY(this,d),g=b-e,f=a.timingFunction||"linear",h=a.behavior||null,c=0;if(a.duration||a.speed){if(a.duration&&a.speed)throw new Error(`[JSGLib] Trying to call <${this.tagName.toLowerCase()}>.moveY(${d}) with duration ${a.duration} AND speed ${a.speed}: "duration" and "speed" options cannot be both set in the same call.`);c=a.duration?cleanDuration(a.duration):cleanDuration(Math.abs(g)/a.speed)}let i={prevY:e,nextY:b,duration:c,timingFunction:f,behavior:h},j=dispatchEvent(this,"jsglib:beforeMoveY",{detail:i,cancelable:!0,bubbles:!0});if(j.defaultPrevented)return!1;this._clearOnEndY(),this._onEndY=()=>{let b=dispatchEvent(this,"jsglib:afterMoveY",{detail:i,cancelable:!0,bubbles:!0});if(b.defaultPrevented)return!1;"reverse"===h?this.moveY(e,a):"repeat"===h&&this.moveY(this.y+g,a)},this._transformContainers.translateY.addEventListener("jsglib:transformationEnd",this._onEndY,{once:!0}),this._transformContainers.translateY.duration=c,this._transformContainers.translateY.timingFunction=f,this.y=b}stop(){this._clearOnEndX(),this._clearOnEndY(),this._transformContainers.translateX.duration=0,this._transformContainers.translateY.duration=0,this.x=this.x,this.y=this.y}}window._jsglibCustomClasses=window._jsglibCustomClasses||{};let define=a=>{if(!a.name||"anonymous"===a.name)throw new Error(`[JSGLib] function sent to JSGLib.define must have a name. Received: ${a.toString()}`);window._jsglibCustomClasses[a.name]=a},initElements=()=>{customElements.define("jsglib-game",JSGLibGame),customElements.define("jsglib-transform",JSGLibTransform),customElements.define("jsglib-element",JSGLibElement)};export default{define,initElements,Game:JSGLibGame,Element:JSGLibElement,Transform:JSGLibTransform,...utils}